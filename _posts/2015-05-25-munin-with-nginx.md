---
layout: post
title: Munin with Nginx
---

You need to configure Nginx work with cgi scripts.
Add to munin.conf this parameters:
{% highlight text %}
html_strategy cgi
graph_strategy cgi
{% endhighlight %}

It means that html and graphs will be generated by cgi scripts.

Next, confugure your nginx server config:
{% highlight text %}
location ^~ /munin-cgi/munin-cgi-graph/ {
    access_log off;
	fastcgi_split_path_info ^(/munin-cgi/munin-cgi-graph)(.*);
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_pass unix:/var/run/munin/fcgi-graph.sock;
    include fastcgi_params;
}
location /munin/static/ {
    alias /etc/munin/static/;
}
location /munin/ {
    fastcgi_split_path_info ^(/munin)(.*);
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_pass unix:/var/run/munin/fcgi-html.sock;
    include fastcgi_params;
}
{% endhighlight %}

And then start fcgi sockets:
{% highlight sh %}
$ spawn-fcgi -s /var/run/munin/fcgi-graph.sock -U www-data -u www-data -g www-data /usr/lib/munin/cgi/munin-cgi-graph
$ spawn-fcgi -s /var/run/munin/fcgi-html.sock -U www-data -u www-data -g munin /usr/lib/munin/cgi/munin-cgi-html
{% endhighlight %}

To debug, just add `-n` parameter. Pleast be aware, in that way your nginx server must work by www-data user. If not change your configuration or change username and group in the commands.

[Here](http://munin-monitoring.org/wiki/MuninConfigurationMasterCGI) official manual, there is some difference. Insteag of `cgi-bin` I write `munin-cgi`, don't know why, but on that works for me.
